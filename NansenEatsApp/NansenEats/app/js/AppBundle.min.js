(function(){"use strict";var n=angular.module("app",["ngAnimate","ngRoute","ngSanitize","kendo.directives","LocalStorageModule"]),t;n.config(function(n){n.when("/",{templateUrl:"app/templates/restaurantlist.html",controller:"RestaurantListController as vm"}).when("/login",{templateUrl:"app/templates/login.html",controller:"LoginController as vm"}).when("/associate",{templateUrl:"app/templates/associate.html",controller:"AssociateController as vm"}).when("/signup",{templateUrl:"app/templates/signup.html",controller:"SignupController as vm"}).when("/restaurant/new-restaurant",{templateUrl:"app/templates/restaurantform.html",controller:"AddRestaurantController as vm"}).when("/restaurant/:restaurantid",{templateUrl:"app/templates/restaurantdetails.html",controller:"RestaurantDetailsController as vm"}).when("/restaurant/:restaurantid/edit",{templateUrl:"app/templates/restaurantform.html",controller:"EditRestaurantController as vm"}).when("/restaurant/:restaurantid/new-review",{templateUrl:"app/templates/reviewForm.html",controller:"AddReviewController as vm"}).when("/rating/:ratingid/edit",{templateUrl:"app/templates/reviewForm.html",controller:"EditRatingController as vm"}).when("/comment/:commentid/edit",{templateUrl:"app/templates/reviewForm.html",controller:"EditCommentController as vm"}).when("/search/:searchTerm",{templateUrl:"app/templates/search.html",controller:"SearchController as vm"}).otherwise({redirectTo:"/"})});n.config(["localStorageServiceProvider",function(n){n.setPrefix("app")}]);n.config(function(n){n.interceptors.push("authInterceptorService")});t="http://eatsapi.azurewebsites.net";n.constant("ngAuthSettings",{apiServiceBaseUri:t,clientId:"angJsAzureApp"});n.run(["authService",function(n){n.fillAuthData()}])})(),function(){"use strict";function n(n){function t(t){return function(i){n.error(t,i)}}return{catcher:t}}angular.module("app").factory("exception",n);n.$inject=["logger"]}(),function(){"use strict";function n(n){function t(t,i){n.error("Error: "+t,i)}function i(t,i){n.info("Info: "+t,i)}function r(t,i){n.info("Success: "+t,i)}function u(t,i){n.warn("Warning: "+t,i)}return{error:t,info:i,success:r,warning:u,log:n.log}}angular.module("app").factory("logger",n);n.$inject=["$log"]}(),function(){"use strict";function n(){return{restrict:"EA",scope:{loadedproperty:"="},template:'<div ng-hide="loadedproperty" class="col-sm-12 loading"><\/div>'}}angular.module("app").directive("loader",n);n.$inject=["$window"]}(),function(){"use strict";function n(n,t,i,r){function u(n){return r.search(n).then(function(n){return n})}return{search:u}}angular.module("app").factory("util",n);n.$inject=["$http","$location","exception","dataservice"]}(),function(){"use strict";function n(n,t,i){var r={},u=function(n){n.headers=n.headers||{};var t=i.get("authorizationData");return t&&(n.headers.Authorization="Bearer "+t.token),n},f=function(i){return i.status===401&&t.path("/login"),n.reject(i)};return r.request=u,r.responseError=f,r}angular.module("app").factory("authInterceptorService",n);n.$inject=["$q","$location","localStorageService"]}(),function(){"use strict";function n(n,t,i,r){var o=r.apiServiceBaseUri,f={},u={isAuth:!1,userName:"",userId:"",userDisplayName:"",userImageUrl:"",userEmail:"",useRefreshTokens:!1},s=function(t){return e(),n.post(o+"/api/account/register",t).then(function(n){return n})},h=function(f){var h="grant_type=password&username="+f.userName+"&password="+f.password,s;return f.useRefreshTokens&&(h=h+"&client_id="+r.clientId),s=t.defer(),n.post(o+"/token",h,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){var h=n.access_token,t=f.userName,r=n.userId,e=n.userDisplayName,o=n.userImageUrl,c=f.email;f.useRefreshTokens?i.set("authorizationData",{token:h,userName:t,refreshToken:n.refresh_token,useRefreshTokens:!0,userId:r,userDisplayName:e,userImageUrl:o,userEmail:c}):i.set("authorizationData",{token:h,userName:t,refreshToken:"",useRefreshTokens:!1,userId:r,userDisplayName:e,userImageUrl:o,userEmail:c});u.isAuth=!0;u.userName=t;u.userId=r;u.userDisplayName=e;u.userImageUrl=o;u.userEmail="";u.useRefreshTokens=f.useRefreshTokens;s.resolve(n)}).error(function(n){e();s.reject(n)}),s.promise},e=function(){i.remove("authorizationData");u.isAuth=!1;u.userName="";u.userId="";u.userDisplayName="";u.userImageUrl="";u.userEmail="";u.useRefreshTokens=!1},c=function(){var n=i.get("authorizationData");n&&(u.isAuth=!0,u.userName=n.userName,u.userId=n.userId,u.userDisplayName=n.userDisplayName,u.userImageUrl=n.userImageUrl,u.userEmail=n.userEmail,u.useRefreshTokens=n.useRefreshTokens)},l=function(){var u=t.defer(),f=i.get("authorizationData"),s;return f&&f.useRefreshTokens&&(s="grant_type=refresh_token&refresh_token="+f.refreshToken+"&client_id="+r.clientId,i.remove("authorizationData"),n.post(o+"/token",s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){i.set("authorizationData",{token:n.access_token,userName:n.userName,refreshToken:n.refresh_token,useRefreshTokens:!0});u.resolve(n)}).error(function(n){e();u.reject(n)})),u.promise},a=function(r){var f=t.defer();return n.get(o+"/api/account/ObtainLocalAccessToken",{params:{provider:r.provider,externalAccessToken:r.externalAccessToken}}).success(function(n){i.set("authorizationData",{token:n.access_token,userName:n.userName,refreshToken:"",useRefreshTokens:!1});u.isAuth=!0;u.userName=n.userName;u.useRefreshTokens=!1;f.resolve(n)}).error(function(n){e();f.reject(n)}),f.promise},v=function(r){var f=t.defer();return n.post(o+"/api/account/registerexternal",r).success(function(n){i.set("authorizationData",{token:n.access_token,userName:n.userName,refreshToken:"",useRefreshTokens:!1});u.isAuth=!0;u.userName=n.userName;u.useRefreshTokens=!1;f.resolve(n)}).error(function(n){e();f.reject(n)}),f.promise};return f.saveRegistration=s,f.login=h,f.logOut=e,f.fillAuthData=c,f.authentication=u,f.refreshToken=l,f.obtainAccessToken=a,f.externalAuthData={provider:"",userName:"",externalAccessToken:""},f.registerExternal=v,f}angular.module("app").factory("authService",n);n.$inject=["$http","$q","localStorageService","ngAuthSettings"]}(),function(){"use strict";function n(n,t,i,r){function f(){function r(n){return n.data}return n.get(u+"/api/restaurants").then(r).catch(function(n){i.catcher("XHR Failed for getRestaurants")(n);t.url("/")})}function e(r){function f(n){return n.data}return n.get(u+"/api/restaurants/"+r).then(f).catch(function(n){i.catcher("XHR Failed for getRestaurant")(n);t.url("/")})}function o(t){function r(n){return n.data}return n.post(u+"/api/restaurants",t).then(r).catch(function(n){i.catcher("XHR Failed for addRestaurant")(n)})}function s(t,r){function f(n){return n.data}return n.put(u+"/api/restaurants/"+t,r).then(f).catch(function(n){i.catcher("XHR Failed for editRestaurant")(n)})}function h(){function r(n){return n.data}return n.get(u+"/api/categories").then(r).catch(function(n){i.catcher("XHR Failed for getTags")(n);t.url("/")})}function c(r){function f(n){return n.data}return n.get(u+"/api/rating/"+r).then(f).catch(function(n){i.catcher("XHR Failed for getRating")(n);t.url("/")})}function l(t){function r(n){return n.data}return n.post(u+"/api/rating",t).then(r).catch(function(n){i.catcher("XHR Failed for addRating")(n)})}function a(t,r){function f(n){return n.data}return n.put(u+"/api/rating/"+t,r).then(f).catch(function(n){i.catcher("XHR Failed for editRating")(n)})}function v(r){function f(n){return n.data}return n.get(u+"/api/comment/"+r).then(f).catch(function(n){i.catcher("XHR Failed for getComment")(n);t.url("/")})}function y(t){function r(n){return n.data}return n.post(u+"/api/comment",t).then(r).catch(function(n){i.catcher("XHR Failed for addComment")(n)})}function p(t,r){function f(n){return n.data}return n.put(u+"/api/comment/"+t,r).then(f).catch(function(n){i.catcher("XHR Failed for editComment")(n)})}function w(r){function f(n){return n.data}return n.get(u+"/api/search/?searchTerm="+r).then(f).catch(function(n){i.catcher("XHR Failed for search")(n);t.url("/")})}var u=r.apiServiceBaseUri;return{getRestaurants:f,getRestaurant:e,addRestaurant:o,editRestaurant:s,getTags:h,getRating:c,addRating:l,editRating:a,getComment:v,addComment:y,editComment:p,search:w}}angular.module("app").factory("dataservice",n);n.$inject=["$http","$location","exception","ngAuthSettings"]}(),function(){"use strict";function n(n,t,i){var r=this,u;r.savedSuccessfully=!1;r.message="";r.registerData={userName:t.externalAuthData.userName,provider:t.externalAuthData.provider,externalAccessToken:t.externalAuthData.externalAccessToken};r.registerExternal=function(){t.registerExternal(r.registerData).then(function(){r.savedSuccessfully=!0;r.message="User has been registered successfully, you will be redicted to orders page in 2 seconds.";u()},function(n){var t=[];for(var i in n.modelState)t.push(n.modelState[i]);r.message="Failed to register user due to:"+t.join(" ")})};u=function(){var t=i(function(){i.cancel(t);n.path("/")},2e3)}}angular.module("app").controller("AssociateController",n);n.$inject=["$location","authService","$timeout"]}(),function(){"use strict";function n(n,t,i){var r=this;r.loginData={userName:"",password:"",useRefreshTokens:!1};r.message="";r.login=function(){t.login(r.loginData).then(function(){n.path("/")},function(n){r.message=n.error_description})};r.authExternalProvider=function(n){var t=location.protocol+"//"+location.host+"/authcomplete.html",r=i.apiServiceBaseUri+"/api/Account/ExternalLogin?provider="+n+"&response_type=token&client_id="+i.clientId+"&redirect_uri="+t,u;window.$windowScope=this;u=window.open(r,"Authenticate Account","location=0,status=0,width=600,height=750")};r.authCompletedCB=function(i){r.$apply(function(){if(i.haslocalaccount=="False")t.logOut(),t.externalAuthData={provider:i.provider,userName:i.external_user_name,externalAccessToken:i.external_access_token},n.path("/associate");else{var u={provider:i.provider,externalAccessToken:i.external_access_token};t.obtainAccessToken(u).then(function(){n.path("/")},function(n){r.message=n.error_description})}})}}angular.module("app").controller("LoginController",n);n.$inject=["$location","authService","ngAuthSettings"]}(),function(){"use strict";function n(n,t,i){var r=this,u;r.savedSuccessfully=!1;r.message="";r.registration={userName:"",displayName:"",email:"",password:"",confirmPassword:""};r.signUp=function(){i.saveRegistration(r.registration).then(function(){r.savedSuccessfully=!0;r.message="User has been registered successfully, you will be redicted to login page in 2 seconds.";u()},function(n){var u=[],i,t;for(i in n.data.modelState)for(t=0;t<n.data.modelState[i].length;t++)u.push(n.data.modelState[i][t]);r.message="Failed to register user due to:"+u.join(" ")})};u=function(){var i=t(function(){t.cancel(i);n.path("/login")},2e3)}}angular.module("app").controller("SignupController",n);n.$inject=["$location","$timeout","authService"]}(),function(){"use strict";function n(n,t,i,r){function f(){u.offcanvasActive=!u.offcanvasActive}function e(){n.url("/search/"+u.searchTerm)}var u=this;u.title="ShellController";u.searchTerm="";u.search=e;u.offcanvasActive=!1;u.showOffcanvasButton=!0;u.toggleCanvas=f;u.logOut=function(){r.logOut();n.path("/")};u.authentication=r.authentication}angular.module("app").controller("ShellController",n);n.$inject=["$location","dataservice","logger","authService"]}(),function(){"use strict";function n(n,t,i,r){function e(){return u.searchTerm=r.searchTerm,f(u.searchTerm)}function f(n){return t.search(n).then(function(n){return u.results=n,u.results})}var u=this;u.title="SearchController";u.search=f;e()}angular.module("app").controller("SearchController",n);n.$inject=["$location","util","logger","$routeParams"]}(),function(){"use strict";function n(n,t,i){function u(n){if(r.sort==n){r.reverse=!r.reverse;return}r.sort=n;r.reverse=!1}function f(){return e().then(function(){i.info("Activated Restaurants View");r.changeSort("AverageRating")})}function e(){return t.getRestaurants().then(function(n){return r.restaurants=n,r.restaurants})}var r=this;r.title="RestaurantListController";r.restaurants=[];f();r.sort="AverageRating";r.reverse=!1;r.offcanvas=!0;r.sortGroup=[{Sort:"AverageRating",Name:"Rating"},{Sort:"DistanceFromOffice",Name:"Distance"},{Sort:"Name",Name:"Name"},{Sort:"PriceRangeMin",Name:"Price"}];r.changeSort=u}angular.module("app").controller("RestaurantListController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}(),function(){"use strict";function n(n,t,i,r){function f(){return e().then(function(){i.info("Activated Restaurant Details View")})}function e(){return u.restaurantId=r.restaurantid,t.getRestaurant(u.restaurantId).then(function(n){return u.restaurant=n,u.restaurant})}var u=this;u.title="RestaurantDetailsController";u.restaurant={};f()}angular.module("app").controller("RestaurantDetailsController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}(),function(){"use strict";function n(n,t){function r(){u()}function u(){i.restaurant.city="Chicago"}function f(){i.restaurant&&t.addRestaurant(i.restaurant).then(function(t){t?n.url("/restaurant/"+t.Id):i.restaurant={}})}var i=this;i.title="AddRestaurantController";i.restaurant={};i.handleRestaurant=f;r()}angular.module("app").controller("AddRestaurantController",n);n.$inject=["$location","dataservice","logger"]}(),function(){"use strict";function n(n,t,i,r){function f(){return u.restaurantId=r.restaurantid,t.getRestaurant(u.restaurantId).then(function(n){return u.restaurant=n,u.restaurant})}function e(){u.restaurant&&t.editRestaurant(u.restaurantId,u.restaurant).then(function(t){t&&n.url("/restaurant/"+t.Id)})}var u=this;u.title="EditRestaurantController";u.restaurant={};u.handleRestaurant=e;f()}angular.module("app").controller("EditRestaurantController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}(),function(){"use strict";function n(n,t,i,r){function f(){e()}function e(){u.rating.RestaurantId=r.restaurantid;u.comment.RestaurantId=r.restaurantid;t.getTags().then(function(n){n&&(u.availableTags=n.map(function(n){return n.Name}))})}function o(){u.rating&&t.addRating(u.rating).then(function(i){i&&u.comment.value?t.addComment(u.comment).then(function(t){t&&n.url("/restaurant/"+r.restaurantid)}):i?n.url("/restaurant/"+r.restaurantid):(u.rating.RestaurantId=r.restaurantid,u.comment.RestaurantId=r.restaurantid)})}var u=this;u.title="AddReviewController";u.rating={};u.comment={};u.handleReview=o;u.showComment=!0;u.showRating=!0;u.availableTags=[];f()}angular.module("app").controller("AddReviewController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}(),function(){"use strict";function n(n,t,i,r){function f(){u.ratingId=r.ratingid;t.getRating(u.ratingId).then(function(n){return u.rating=n,u.rating});t.getTags().then(function(n){n&&(u.availableTags=n.map(function(n){return n.Name}))})}function e(){u.rating&&t.editRating(u.ratingId,u.rating).then(function(t){t&&n.url("/restaurant/"+t.RestaurantId)})}var u=this;u.title="EditRatingController";u.rating={};u.handleReview=e;u.showComment=!1;u.showRating=!0;f()}angular.module("app").controller("EditRatingController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}(),function(){"use strict";function n(n,t,i,r){function f(){return u.commentId=r.commentid,t.getComment(u.commentId).then(function(n){return u.comment=n,u.comment})}function e(){u.comment&&t.editComment(u.commentId,u.comment).then(function(t){t&&n.url("/restaurant/"+t.RestaurantId)})}var u=this;u.title="EditCommentController";u.rating={};u.handleReview=e;u.showComment=!0;u.showRating=!1;f()}angular.module("app").controller("EditCommentController",n);n.$inject=["$location","dataservice","logger","$routeParams"]}();
//# sourceMappingURL=AppBundle.min.js.map
